<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MEDU Case Vault - Medical Education Department</title>
  <style>
    /* Reset & Base */
    *, *::before, *::after {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      padding: 0;
      font-family: 'Poppins', 'Roboto', sans-serif;
      background: linear-gradient(135deg, #1e3c72, #2a5298);
      color: #e0eaff;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    a {
      color: #a8c0ff;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    h1, h2, h3 {
      margin: 0 0 0.4rem 0;
    }
    h1 {
      font-weight: 700;
      font-size: 2.5rem;
      letter-spacing: 1.2px;
      text-shadow: 0 0 8px rgba(255, 255, 255, 0.3);
    }
    h2 {
      font-weight: 600;
      font-size: 1.6rem;
      margin-top: 1rem;
    }
    h3 {
      font-weight: 500;
      font-size: 1.2rem;
    }

    /* Container */
    #app, #loginPage {
      max-width: 1300px;
      margin: 1rem auto;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 16px;
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.4), inset 0 0 0 1px rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(15px);
      -webkit-backdrop-filter: blur(15px);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    /* Header */
    header {
      background: rgba(10, 30, 80, 0.85);
      padding: 1.2rem 2rem;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.7);
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    header h1 {
      color: #a8c0ff;
    }
    header small {
      color: #89aaffcc;
      font-weight: 400;
      font-size: 0.9rem;
    }
    #darkModeToggle, #logoutBtn {
      cursor: pointer;
      background: #3458f0;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 12px;
      color: white;
      font-weight: 600;
      user-select: none;
      transition: background 0.3s ease;
      margin-left: 0.5rem;
    }
    #darkModeToggle:hover, #logoutBtn:hover {
      background: #567dff;
    }

    /* Layout */
    main {
      display: flex;
      flex-grow: 1;
      min-height: 600px;
    }

    /* Sidebar */
    nav.sidebar {
      width: 260px;
      background: rgba(20, 40, 90, 0.8);
      border-right: 1.5px solid #4f6ef7aa;
      display: flex;
      flex-direction: column;
      padding: 1rem 1rem 2rem 1rem;
      overflow-y: auto;
    }
    nav.sidebar h2 {
      margin-bottom: 1rem;
      text-align: center;
      color: #b0c7ff;
      text-shadow: 0 0 5px rgba(255, 255, 255, 0.25);
    }
    nav.sidebar a {
      padding: 0.7rem 1rem;
      margin-bottom: 0.5rem;
      color: #abc2ff;
      border-radius: 10px;
      font-weight: 500;
      display: block;
      transition: background-color 0.3s ease;
    }
    nav.sidebar a.active, nav.sidebar a:hover {
      background: #4a67f5;
      color: #fff;
      box-shadow: 0 0 8px #5b78ffcc;
    }

    /* Content */
    section.content {
      flex-grow: 1;
      background: rgba(255, 255, 255, 0.05);
      padding: 2rem 3rem;
      overflow-y: auto;
      position: relative;
    }
    section.content h2 {
      margin-bottom: 1rem;
      border-bottom: 2px solid #678dffcc;
      padding-bottom: 0.3rem;
      text-shadow: 0 0 10px rgba(104, 141, 255, 0.6);
    }

    /* Table */
    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0 12px;
      font-size: 0.95rem;
    }
    thead tr {
      background: #3951b3cc;
      text-align: left;
      color: #d0dbff;
      font-weight: 600;
    }
    th, td {
      padding: 12px 18px;
    }
    tbody tr {
      background: rgba(255, 255, 255, 0.07);
      box-shadow: inset 0 0 0 1px #4c63d2aa;
      border-radius: 10px;
      transition: background-color 0.3s ease;
      cursor: pointer;
    }
    tbody tr:hover {
      background-color: #4560e5bb;
    }

    /* Status badges */
    .badge {
      padding: 0.25rem 0.7rem;
      border-radius: 12px;
      font-weight: 600;
      font-size: 0.85rem;
      color: white;
      text-align: center;
      display: inline-block;
      min-width: 60px;
    }
    .badge.solved {
      background: #34c759;
      box-shadow: 0 0 10px #32d858aa;
    }
    .badge.open {
      background: #ff3b30;
      box-shadow: 0 0 10px #ff4a3daa;
    }
    .badge.pending {
      background: #ffcc00;
      color: #222;
      box-shadow: 0 0 10px #ffdd44aa;
    }

    /* Filters and search */
    .filters {
      display: flex;
      gap: 1rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
    }
    .filters label {
      font-weight: 600;
      color: #aac3ffdd;
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }
    select, input[type="search"], input[type="text"], input[type="password"] {
      padding: 0.35rem 0.7rem;
      border-radius: 8px;
      border: none;
      font-size: 1rem;
      outline-offset: 2px;
      outline-color: #799cff;
      background: rgba(255, 255, 255, 0.15);
      color: #e0eaff;
      transition: background-color 0.3s ease;
    }
    select:hover, input[type="search"]:hover, input[type="text"]:hover, input[type="password"]:hover,
    select:focus, input[type="search"]:focus, input[type="text"]:focus, input[type="password"]:focus {
      background: rgba(255, 255, 255, 0.3);
    }

    /* Sorting buttons */
    .sort-btn {
      background: transparent;
      border: none;
      color: #abc2ff;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.9rem;
      margin-left: 6px;
      transition: color 0.3s ease;
      user-select: none;
    }
    .sort-btn:hover {
      color: #f0f8ff;
    }

    /* Modal styling */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }
    .modal.active {
      display: flex;
      animation: fadeIn 0.3s ease forwards;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .modal-content {
      background: rgba(255, 255, 255, 0.07);
      border-radius: 20px;
      padding: 2rem 2.5rem;
      max-width: 700px;
      width: 90%;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.7), inset 0 0 0 1px rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(15px);
      -webkit-backdrop-filter: blur(15px);
      color: #e1eaff;
      overflow-y: auto;
      max-height: 80vh;
      position: relative;
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }
    .modal-header h2 {
      font-size: 1.8rem;
      color: #a5b8ff;
    }
    .close-btn {
      background: none;
      border: none;
      font-size: 1.8rem;
      color: #a5b8ff;
      cursor: pointer;
      font-weight: 700;
      transition: color 0.3s ease;
    }
    .close-btn:hover {
      color: #fff;
    }
    .modal-section {
      margin-bottom: 1.4rem;
    }
    .modal-section h3 {
      font-size: 1.2rem;
      color: #a5b8ff;
      margin-bottom: 0.5rem;
    }
    .modal-section p, .modal-section textarea, .modal-section input, .modal-section select {
      font-size: 1rem;
      line-height: 1.5;
      background: rgba(255, 255, 255, 0.1);
      border: none;
      border-radius: 12px;
      padding: 0.8rem 1rem;
      color: #d9e3ff;
      resize: vertical;
      min-height: 80px;
      width: 100%;
      font-family: 'Poppins', sans-serif;
      box-shadow: inset 0 0 5px rgba(255, 255, 255, 0.2);
    }
    .modal-section textarea {
      min-height: 120px;
    }
    .modal-section select {
      min-height: auto;
    }

    /* Forms */
    form.new-case-form, form.feedback-form, form.edit-case-form, form.login-form {
      max-width: 650px;
      margin: 0 auto;
    }
    form label {
      font-weight: 600;
      display: block;
      margin-bottom: 0.3rem;
      color: #b8c4ff;
    }
    form input[type="text"], form input[type="password"], form select, form textarea {
      width: 100%;
      padding: 0.6rem 1rem;
      margin-bottom: 1.2rem;
      border-radius: 10px;
      border: none;
      background: rgba(255, 255, 255, 0.15);
      color: #e0eaff;
      font-size: 1rem;
      transition: background-color 0.3s ease;
      box-shadow: inset 0 0 7px rgba(255, 255, 255, 0.15);
    }
    form input[type="text"]:focus, form input[type="password"]:focus, form select:focus, form textarea:focus {
      background: rgba(255, 255, 255, 0.3);
      outline: none;
    }
    form button.submit-btn, form button.delete-btn {
      background: #3468f0;
      border: none;
      color: white;
      padding: 0.8rem 1.6rem;
      font-weight: 700;
      font-size: 1.1rem;
      border-radius: 16px;
      cursor: pointer;
      box-shadow: 0 0 12px #527ff6bb;
      transition: background-color 0.3s ease;
      margin-right: 0.5rem;
    }
    form button.submit-btn:hover {
      background: #4a83ff;
    }
    form button.delete-btn {
      background: #ff3b30;
      box-shadow: 0 0 12px #ff4a3daa;
    }
    form button.delete-btn:hover {
      background: #ff5550;
    }

    /* Notification Toast */
    .notification {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      padding: 1rem 1.5rem;
      color: #e0eaff;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(10px);
      z-index: 10000;
      display: none;
      animation: slideIn 0.3s ease forwards;
    }
    .notification.success {
      background: rgba(52, 199, 89, 0.2);
    }
    .notification.error {
      background: rgba(255, 59, 48, 0.2);
    }
    .notification.active {
      display: block;
    }
    @keyframes slideIn {
      from { transform: translateY(100px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    /* Login Page */
    .login-container {
      max-width: 400px;
      margin: 5rem auto;
      padding: 2rem;
    }
    .login-container h2 {
      text-align: center;
      margin-bottom: 1.5rem;
    }
    .error-message {
      color: #ff4a3daa;
      font-size: 0.9rem;
      margin-bottom: 1rem;
      text-align: center;
      display: none;
    }
    .error-message.active {
      display: block;
    }

    /* Dashboard Stats */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }
    .stat-card {
      background: rgba(255, 255, 255, 0.07);
      border-radius: 12px;
      padding: 1rem;
      text-align: center;
      box-shadow: inset 0 0 0 1px #4c63d2aa;
    }
    .stat-card h3 {
      font-size: 1.1rem;
      color: #aac3ff;
    }
    .stat-card p {
      font-size: 1.5rem;
      font-weight: 700;
      color: #fff;
      margin: 0.5rem 0 0;
    }

    /* Responsive */
    @media (max-width: 900px) {
      main {
        flex-direction: column;
      }
      nav.sidebar {
        width: 100%;
        order: 2;
        border-right: none;
        border-bottom: 1.5px solid #4f6ef7aa;
        padding: 0.5rem 0.7rem;
        display: flex;
        overflow-x: auto;
      }
      nav.sidebar a {
        flex: 1 0 auto;
        text-align: center;
        padding: 0.6rem 1rem;
        margin-bottom: 0;
        border-radius: 0;
      }
      section.content {
        order: 1;
        padding: 1.5rem 1.5rem 3rem 1.5rem;
      }
      table thead {
        display: none;
      }
      table, tbody, tr, td {
        display: block;
        width: 100%;
      }
      tbody tr {
        margin-bottom: 1rem;
        background: rgba(255, 255, 255, 0.07);
        box-shadow: inset 0 0 0 1px #4c63d2aa;
        border-radius: 10px;
        padding: 1rem;
      }
      tbody tr:hover {
        background: #4560e5bb;
      }
      tbody td {
        padding: 8px 6px;
        text-align: right;
        position: relative;
        padding-left: 50%;
        font-size: 0.9rem;
      }
      tbody td::before {
        content: attr(data-label);
        position: absolute;
        left: 16px;
        top: 50%;
        transform: translateY(-50%);
        font-weight: 600;
        color: #aac3ffdd;
        white-space: nowrap;
        font-size: 0.9rem;
        text-transform: uppercase;
      }
      .modal-content {
        width: 95%;
        padding: 1.5rem;
      }
      .stats-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <!-- Login Page -->
  <div id="loginPage" style="display: none;">
    <div class="login-container">
      <h2>Admin Login</h2>
      <div class="error-message" id="loginError">Invalid username or password</div>
      <form class="login-form" aria-label="Admin login form">
        <label for="username">Username</label>
        <input type="text" id="username" name="username" required placeholder="Enter username" autocomplete="username" />
        <label for="password">Password</label>
        <input type="password" id="password" name="password" required placeholder="Enter password" autocomplete="current-password" />
        <button type="submit" class="submit-btn">Login</button>
      </form>
    </div>
  </div>

  <!-- Main App -->
  <div id="app" style="display: none;">
    <header>
      <div>
        <h1>MEDU Case Vault</h1>
        <small>By Luna.C.Everly | Medical Education Department</small>
      </div>
      <div>
        <button id="darkModeToggle" aria-label="Toggle dark mode">🌙 Dark Mode</button>
        <button id="logoutBtn" aria-label="Logout">Logout</button>
      </div>
    </header>

    <main>
      <nav class="sidebar" aria-label="Primary">
        <h2>Navigation</h2>
        <a href="#" class="nav-link active" data-section="dashboard">Dashboard</a>
        <a href="#" class="nav-link" data-section="cases">Cases</a>
        <a href="#" class="nav-link" data-section="newcase">New Case</a>
        <a href="#" class="nav-link" data-section="feedback">Feedback</a>
        <a href="#" class="nav-link" data-section="about">About</a>
      </nav>
      <section class="content" id="content"></section>
    </main>
  </div>

  <!-- Case Detail/Edit Modal -->
  <div class="modal" id="caseModal" aria-hidden="true" role="dialog" aria-labelledby="modalTitle">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modalTitle">Case Details</h2>
        <button class="close-btn" aria-label="Close modal" id="modalClose">×</button>
      </div>
      <div id="modalBody"></div>
    </div>
  </div>

  <!-- Notification Toast -->
  <div class="notification" id="notification"></div>

  <script>
    (() => {
      // Initial data
      const initialCases = [
        {
          id: "MEDU-001",
          title: "Pediatric Ethical Dilemma",
          type: "Ethical",
          status: "Open",
          assignedTo: "Dr. Smith",
          lastUpdated: "2025-07-05",
          symptoms: "Parental refusal of treatment in a minor",
          history: "12-year-old child with severe asthma exacerbation",
          labResults: "Blood gas normal, O2 sat 92%",
          diagnosis: "Acute asthma attack with refusal of intervention",
          outcome: "Pending parental consent",
          notes: ""
        },
        {
          id: "MEDU-002",
          title: "ER Trauma Case",
          type: "Emergency",
          status: "Solved",
          assignedTo: "Dr. Lee",
          lastUpdated: "2025-06-25",
          symptoms: "Severe head trauma, unconscious",
          history: "Hit by car 1 hour ago",
          labResults: "CT shows subdural hematoma",
          diagnosis: "Acute subdural hematoma with midline shift",
          outcome: "Surgical evacuation successful",
          notes: "Patient improved post-op"
        },
        {
          id: "MEDU-003",
          title: "Pediatric Fever Evaluation",
          type: "Pediatrics",
          status: "Pending",
          assignedTo: "Dr. Chen",
          lastUpdated: "2025-07-01",
          symptoms: "Fever, rash, irritability",
          history: "3-year-old with 2-day history of fever",
          labResults: "CBC normal, CRP elevated",
          diagnosis: "Likely viral exanthem",
          outcome: "Observation recommended",
          notes: "Parents instructed on warning signs"
        }
      ];

      // State management
      let cases = JSON.parse(localStorage.getItem('cases')) || initialCases;
      let feedbackList = JSON.parse(localStorage.getItem('feedbackList')) || [];
      let filteredCases = [...cases];
      let currentSort = { col: null, asc: true };
      let isAuthenticated = localStorage.getItem('isAuthenticated') === 'true';

      // DOM elements
      const app = document.getElementById('app');
      const loginPage = document.getElementById('loginPage');
      const content = document.getElementById('content');
      const modal = document.getElementById('caseModal');
      const modalTitle = document.getElementById('modalTitle');
      const modalBody = document.getElementById('modalBody');
      const modalClose = document.getElementById('modalClose');
      const notification = document.getElementById('notification');
      const navLinks = document.querySelectorAll('.nav-link');
      const darkModeToggle = document.getElementById('darkModeToggle');
      const logoutBtn = document.getElementById('logoutBtn');

      // Notification helper
      function showNotification(message, type = 'success') {
        notification.textContent = message;
        notification.className = `notification ${type} active`;
        setTimeout(() => {
          notification.className = 'notification';
        }, 3000);
      }

      // Authentication check
      function checkAuth() {
        if (!isAuthenticated) {
          app.style.display = 'none';
          loginPage.style.display = 'block';
          renderLogin();
        } else {
          app.style.display = 'flex';
          loginPage.style.display = 'none';
          activateSection('dashboard');
        }
      }

      // Login form rendering
      function renderLogin() {
        const form = loginPage.querySelector('.login-form');
        const errorMessage = document.getElementById('loginError');
        form.addEventListener('submit', e => {
          e.preventDefault();
          const username = form.username.value.trim();
          const password = form.password.value.trim();
          if (username === 'Luna.C.Everly' && password === 'lunamedudirector') {
            isAuthenticated = true;
            localStorage.setItem('isAuthenticated', 'true');
            app.style.display = 'flex';
            loginPage.style.display = 'none';
            activateSection('dashboard');
            form.reset();
            errorMessage.classList.remove('active');
          } else {
            errorMessage.classList.add('active');
          }
        });
      }

      // Logout
      logoutBtn.addEventListener('click', () => {
        isAuthenticated = false;
        localStorage.removeItem('isAuthenticated');
        app.style.display = 'none';
        loginPage.style.display = 'block';
        renderLogin();
      });

      // Dark mode toggle
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      if (localStorage.getItem('darkMode') === 'true' || (!localStorage.getItem('darkMode') && prefersDark)) {
        document.body.classList.add('dark-mode');
        darkModeToggle.textContent = '☀️ Light Mode';
      }
      darkModeToggle.addEventListener('click', () => {
        document.body.classList.toggle('dark-mode');
        localStorage.setItem('darkMode', document.body.classList.contains('dark-mode') ? 'true' : 'false');
        darkModeToggle.textContent = document.body.classList.contains('dark-mode') ? '☀️ Light Mode' : '🌙 Dark Mode';
      });

      // Render dashboard
      function renderDashboard() {
        const stats = {
          total: cases.length,
          open: cases.filter(c => c.status === 'Open').length,
          pending: cases.filter(c => c.status === 'Pending').length,
          solved: cases.filter(c => c.status === 'Solved').length
        };
        content.innerHTML = `
          <h2>Admin Dashboard</h2>
          <div class="stats-grid">
            <div class="stat-card">
              <h3>Total Cases</h3>
              <p>${stats.total}</p>
            </div>
            <div class="stat-card">
              <h3>Open Cases</h3>
              <p>${stats.open}</p>
            </div>
            <div class="stat-card">
              <h3>Pending Cases</h3>
              <p>${stats.pending}</p>
            </div>
            <div class="stat-card">
              <h3>Solved Cases</h3>
              <p>${stats.solved}</p>
            </div>
          </div>
          <h3>Recent Cases</h3>
          <table aria-label="Recent cases table" role="grid" id="casesTable" tabindex="0">
            <thead>
              <tr>
                <th scope="col">Case ID <button class="sort-btn" data-col="id">↑↓</button></th>
                <th scope="col">Title <button class="sort-btn" data-col="title">↑↓</button></th>
                <th scope="col">Type <button class="sort-btn" data-col="type">↑↓</button></th>
                <th scope="col">Status <button class="sort-btn" data-col="status">↑↓</button></th>
              </tr>
            </thead>
            <tbody>
              ${cases.slice(0, 5).map(c => `
                <tr tabindex="0" role="row" data-id="${c.id}">
                  <td data-label="Case ID">${c.id}</td>
                  <td data-label="Title">${c.title}</td>
                  <td data-label="Type">${c.type}</td>
                  <td data-label="Status"><span class="badge ${c.status.toLowerCase()}">${c.status}</span></td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        `;
        addTableEventListeners();
      }

      // Render case table
      function renderCasesTable() {
        content.innerHTML = `
          <h2>Medical Cases</h2>
          <div class="filters" aria-label="Filter cases">
            <label for="searchInput">Search:
              <input type="search" id="searchInput" placeholder="Search by title or ID" aria-label="Search cases" />
            </label>
            <label for="typeFilter">Type:
              <select id="typeFilter" aria-label="Filter by case type">
                <option value="all">All</option>
                <option value="Ethical">Ethical</option>
                <option value="Emergency">Emergency</option>
                <option value="Pediatrics">Pediatrics</option>
              </select>
            </label>
            <label for="statusFilter">Status:
              <select id="statusFilter" aria-label="Filter by case status">
                <option value="all">All</option>
                <option value="Open">Open</option>
                <option value="Solved">Solved</option>
                <option value="Pending">Pending</option>
              </select>
            </label>
          </div>
          <table aria-label="Cases table" role="grid" id="casesTable" tabindex="0">
            <thead>
              <tr>
                <th scope="col">Case ID <button class="sort-btn" data-col="id">↑↓</button></th>
                <th scope="col">Title <button class="sort-btn" data-col="title">↑↓</button></th>
                <th scope="col">Type <button class="sort-btn" data-col="type">↑↓</button></th>
                <th scope="col">Status <button class="sort-btn" data-col="status">↑↓</button></th>
                <th scope="col">Assigned To <button class="sort-btn" data-col="assignedTo">↑↓</button></th>
                <th scope="col">Last Updated <button class="sort-btn" data-col="lastUpdated">↑↓</button></th>
              </tr>
            </thead>
            <tbody>
              ${filteredCases.map(c => `
                <tr tabindex="0" role="row" data-id="${c.id}">
                  <td data-label="Case ID">${c.id}</td>
                  <td data-label="Title">${c.title}</td>
                  <td data-label="Type">${c.type}</td>
                  <td data-label="Status"><span class="badge ${c.status.toLowerCase()}">${c.status}</span></td>
                  <td data-label="Assigned To">${c.assignedTo}</td>
                  <td data-label="Last Updated">${c.lastUpdated}</td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        `;
        addTableEventListeners();
      }

      // Add table event listeners
      function addTableEventListeners() {
        const sortButtons = document.querySelectorAll('.sort-btn');
        sortButtons.forEach(btn => {
          btn.addEventListener('click', () => {
            currentSort.col = btn.dataset.col;
            currentSort.asc = currentSort.col === btn.dataset.col ? !currentSort.asc : true;
            sortCases();
            renderCasesTable();
          });
        });
        document.getElementById('searchInput')?.addEventListener('input', applyFilters);
        document.getElementById('typeFilter')?.addEventListener('change', applyFilters);
        document.getElementById('statusFilter')?.addEventListener('change', applyFilters);
        document.querySelectorAll('tbody tr').forEach(row => {
          row.addEventListener('click', () => openCaseModal(row.dataset.id));
          row.addEventListener('keypress', e => {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              openCaseModal(row.dataset.id);
            }
          });
        });
      }

      // Sort cases
      function sortCases() {
        if (!currentSort.col) return;
        filteredCases.sort((a, b) => {
          let valA = a[currentSort.col];
          let valB = b[currentSort.col];
          if (currentSort.col === 'lastUpdated') {
            valA = new Date(valA);
            valB = new Date(valB);
          } else {
            valA = valA.toString().toLowerCase();
            valB = valB.toString().toLowerCase();
          }
          return currentSort.asc ? (valA < valB ? -1 : 1) : (valA < valB ? 1 : -1);
        });
      }

      // Apply filters
      function applyFilters() {
        const searchVal = document.getElementById('searchInput')?.value.toLowerCase() || '';
        const typeVal = document.getElementById('typeFilter')?.value || 'all';
        const statusVal = document.getElementById('statusFilter')?.value || 'all';
        filteredCases = cases.filter(c => {
          const matchesSearch = c.title.toLowerCase().includes(searchVal) || c.id.toLowerCase().includes(searchVal);
          const matchesType = typeVal === 'all' || c.type === typeVal;
          const matchesStatus = statusVal === 'all' || c.status === statusVal;
          return matchesSearch && matchesType && matchesStatus;
        });
        sortCases();
        renderCasesTable();
      }

      // Open case modal (view/edit)
      function openCaseModal(id, editMode = false) {
        const caseData = cases.find(c => c.id === id);
        if (!caseData) return;
        modalTitle.textContent = editMode ? `Edit Case: ${caseData.id}` : `${caseData.id} - ${caseData.title}`;
        modalBody.innerHTML = editMode ? `
          <form class="edit-case-form" aria-label="Edit case form">
            <label for="editTitle">Case Title</label>
            <input type="text" id="editTitle" name="title" value="${caseData.title}" required maxlength="100" />
            <label for="editType">Case Type</label>
            <select id="editType" name="type" required>
              <option value="Ethical" ${caseData.type === 'Ethical' ? 'selected' : ''}>Ethical</option>
              <option value="Emergency" ${caseData.type === 'Emergency' ? 'selected' : ''}>Emergency</option>
              <option value="Pediatrics" ${caseData.type === 'Pediatrics' ? 'selected' : ''}>Pediatrics</option>
            </select>
            <label for="editStatus">Status</label>
            <select id="editStatus" name="status" required>
              <option value="Open" ${caseData.status === 'Open' ? 'selected' : ''}>Open</option>
              <option value="Pending" ${caseData.status === 'Pending' ? 'selected' : ''}>Pending</option>
              <option value="Solved" ${caseData.status === 'Solved' ? 'selected' : ''}>Solved</option>
            </select>
            <label for="editAssignedTo">Assigned To</label>
            <input type="text" id="editAssignedTo" name="assignedTo" value="${caseData.assignedTo}" required maxlength="50" />
            <label for="editSymptoms">Symptoms</label>
            <textarea id="editSymptoms" name="symptoms" required>${caseData.symptoms}</textarea>
            <label for="editHistory">History</label>
            <textarea id="editHistory" name="history" required>${caseData.history}</textarea>
            <label for="editLabResults">Lab Results</label>
            <textarea id="editLabResults" name="labResults">${caseData.labResults}</textarea>
            <label for="editDiagnosis">Diagnosis</label>
            <textarea id="editDiagnosis" name="diagnosis">${caseData.diagnosis}</textarea>
            <label for="editOutcome">Outcome</label>
            <textarea id="editOutcome" name="outcome">${caseData.outcome}</textarea>
            <label for="editNotes">Notes</label>
            <textarea id="editNotes" name="notes">${caseData.notes}</textarea>
            <div style="display: flex; gap: 1rem;">
              <button type="submit" class="submit-btn">Save Changes</button>
              <button type="button" class="delete-btn" id="deleteCaseBtn">Delete Case</button>
            </div>
          </form>
        ` : `
          <div class="modal-section"><h3>Symptoms</h3><p>${caseData.symptoms}</p></div>
          <div class="modal-section"><h3>History</h3><p>${caseData.history}</p></div>
          <div class="modal-section"><h3>Lab Results</h3><p>${caseData.labResults || 'N/A'}</p></div>
          <div class="modal-section"><h3>Diagnosis</h3><p>${caseData.diagnosis || 'N/A'}</p></div>
          <div class="modal-section"><h3>Outcome</h3><p>${caseData.outcome || 'N/A'}</p></div>
          <div class="modal-section"><h3>Notes</h3><p>${caseData.notes || 'No notes'}</p></div>
          <button class="submit-btn" id="editCaseBtn" style="margin-bottom: 1rem;">Edit Case</button>
          <form class="feedback-form" aria-label="Case feedback form">
            <label for="feedbackText">Submit Feedback</label>
            <textarea id="feedbackText" name="feedbackText" rows="4" required placeholder="Enter your feedback..."></textarea>
            <button type="submit" class="submit-btn">Submit Feedback</button>
          </form>
        `;
        modal.classList.add('active');
        modal.setAttribute('aria-hidden', 'false');

        if (editMode) {
          const form = modalBody.querySelector('.edit-case-form');
          form.addEventListener('submit', e => {
            e.preventDefault();
            const updatedCase = {
              id: caseData.id,
              title: form.title.value.trim(),
              type: form.type.value,
              status: form.status.value,
              assignedTo: form.assignedTo.value.trim(),
              lastUpdated: new Date().toISOString().split('T')[0],
              symptoms: form.symptoms.value.trim(),
              history: form.history.value.trim(),
              labResults: form.labResults.value.trim(),
              diagnosis: form.diagnosis.value.trim(),
              outcome: form.outcome.value.trim(),
              notes: form.notes.value.trim()
            };
            if (!updatedCase.title || !updatedCase.type || !updatedCase.status || !updatedCase.assignedTo || !updatedCase.symptoms || !updatedCase.history) {
              showNotification('Please fill in all required fields.', 'error');
              return;
            }
            cases = cases.map(c => c.id === caseData.id ? updatedCase : c);
            localStorage.setItem('cases', JSON.stringify(cases));
            filteredCases = [...cases];
            modal.classList.remove('active');
            modal.setAttribute('aria-hidden', 'true');
            showNotification('Case updated successfully!');
            activateSection(document.querySelector('.nav-link.active').dataset.section);
          });
          document.getElementById('deleteCaseBtn').addEventListener('click', () => {
            if (confirm(`Are you sure you want to delete case ${caseData.id}?`)) {
              cases = cases.filter(c => c.id !== caseData.id);
              feedbackList = feedbackList.filter(f => f.caseId !== caseData.id);
              localStorage.setItem('cases', JSON.stringify(cases));
              localStorage.setItem('feedbackList', JSON.stringify(feedbackList));
              filteredCases = [...cases];
              modal.classList.remove('active');
              modal.setAttribute('aria-hidden', 'true');
              showNotification('Case deleted successfully!');
              activateSection('cases');
            }
          });
        } else {
          document.getElementById('editCaseBtn').addEventListener('click', () => openCaseModal(id, true));
          const feedbackForm = modalBody.querySelector('.feedback-form');
          feedbackForm.addEventListener('submit', e => {
            e.preventDefault();
            const feedbackText = feedbackForm.feedbackText.value.trim();
            if (!feedbackText) {
              showNotification('Feedback cannot be empty.', 'error');
              return;
            }
            feedbackList.push({
              caseId: caseData.id,
              feedback: feedbackText,
              timestamp: new Date().toISOString()
            });
            localStorage.setItem('feedbackList', JSON.stringify(feedbackList));
            feedbackForm.reset();
            showNotification('Feedback submitted successfully!');
          });
        }
      }

      // Close modal
      modalClose.addEventListener('click', closeModal);
      modal.addEventListener('click', e => {
        if (e.target === modal) closeModal();
      });
      document.addEventListener('keydown', e => {
        if (e.key === 'Escape' && modal.classList.contains('active')) closeModal();
      });
      function closeModal() {
        modal.classList.remove('active');
        modal.setAttribute('aria-hidden', 'true');
      }

      // Render new case form
      function renderNewCaseForm() {
        content.innerHTML = `
          <h2>Submit New Medical Case</h2>
          <form class="new-case-form" aria-label="New medical case submission form">
            <label for="caseTitle">Case Title</label>
            <input type="text" id="caseTitle" name="caseTitle" required placeholder="Enter case title" maxlength="100" />
            <label for="caseType">Case Type</label>
            <select id="caseType" name="caseType" required>
              <option value="" disabled selected>Select type</option>
              <option value="Ethical">Ethical</option>
              <option value="Emergency">Emergency</option>
              <option value="Pediatrics">Pediatrics</option>
            </select>
            <label for="caseAssignedTo">Assigned To</label>
            <input type="text" id="caseAssignedTo" name="caseAssignedTo" required placeholder="Enter assignee (e.g., Dr. Smith)" maxlength="50" />
            <label for="caseSymptoms">Symptoms</label>
            <textarea id="caseSymptoms" name="caseSymptoms" rows="3" required placeholder="Describe symptoms"></textarea>
            <label for="caseHistory">History</label>
            <textarea id="caseHistory" name="caseHistory" rows="4" required placeholder="Patient history"></textarea>
            <label for="caseLabResults">Lab Results</label>
            <textarea id="caseLabResults" name="caseLabResults" rows="3" placeholder="Lab results (optional)"></textarea>
            <label for="caseDiagnosis">Diagnosis</label>
            <textarea id="caseDiagnosis" name="caseDiagnosis" rows="3" placeholder="Diagnosis (optional)"></textarea>
            <label for="caseOutcome">Outcome</label>
            <textarea id="caseOutcome" name="caseOutcome" rows="3" placeholder="Outcome (optional)"></textarea>
            <button type="submit" class="submit-btn">Submit Case</button>
          </form>
        `;
        const form = content.querySelector('.new-case-form');
        form.addEventListener('submit', e => {
          e.preventDefault();
          const newCase = {
            id: `MEDU-${(cases.length + 1).toString().padStart(3, '0')}`,
            title: form.caseTitle.value.trim(),
            type: form.caseType.value,
            status: 'Open',
            assignedTo: form.caseAssignedTo.value.trim(),
            lastUpdated: new Date().toISOString().split('T')[0],
            symptoms: form.caseSymptoms.value.trim(),
            history: form.caseHistory.value.trim(),
            labResults: form.caseLabResults.value.trim(),
            diagnosis: form.caseDiagnosis.value.trim(),
            outcome: form.caseOutcome.value.trim(),
            notes: ''
          };
          if (!newCase.title || !newCase.type || !newCase.assignedTo || !newCase.symptoms || !newCase.history) {
            showNotification('Please fill in all required fields.', 'error');
            return;
          }
          cases.push(newCase);
          localStorage.setItem('cases', JSON.stringify(cases));
          filteredCases = [...cases];
          form.reset();
          showNotification(`New case ${newCase.id} added!`);
          activateSection('cases');
        });
      }

      // Render feedback section
      function renderFeedback() {
        content.innerHTML = `
          <h2>Case Feedback</h2>
          <div class="filters">
            <label for="feedbackCaseFilter">Filter by Case:
              <select id="feedbackCaseFilter">
                <option value="all">All Cases</option>
                ${cases.map(c => `<option value="${c.id}">${c.id} - ${c.title}</option>`).join('')}
              </select>
            </label>
          </div>
          <div id="feedbackList">
            ${feedbackList.length ? feedbackList.filter(f => document.getElementById('feedbackCaseFilter')?.value === 'all' || f.caseId === document.getElementById('feedbackCaseFilter')?.value)
              .map(f => `
                <div class="modal-section">
                  <h3>Case: ${cases.find(c => c.id === f.caseId)?.title || f.caseId}</h3>
                  <p>${f.feedback}</p>
                  <small>Submitted: ${new Date(f.timestamp).toLocaleString()}</small>
                </div>
              `).join('') : '<p>No feedback available.</p>'}
          </div>
        `;
        document.getElementById('feedbackCaseFilter')?.addEventListener('change', renderFeedback);
      }

      // Render about section
      function renderAbout() {
        content.innerHTML = `
          <h2>About MEDU Case Vault</h2>
          <p>Welcome to the MEDU Case Vault, a curated collection of medical case studies designed for clinical learning and roleplay by the Medical Education Department.</p>
          <p>This vault serves as a professional resource for medical students and educators to review, analyze, and contribute to medical knowledge through simulated real-world cases.</p>
          <p>Features include case management, feedback submission, and an admin dashboard for case oversight.</p>
          <p>Developed by Luna.C.Everly with emphasis on UX, accessibility, and immersive medical education.</p>
        `;
      }

      // Navigation
      navLinks.forEach(link => {
        link.addEventListener('click', e => {
          e.preventDefault();
          activateSection(link.dataset.section);
        });
      });

      // Activate section
      function activateSection(section) {
        navLinks.forEach(link => link.classList.toggle('active', link.dataset.section === section));
        filteredCases = [...cases];
        sortCases();
        switch (section) {
          case 'dashboard':
            renderDashboard();
            break;
          case 'cases':
            renderCasesTable();
            break;
          case 'newcase':
            renderNewCaseForm();
            break;
          case 'feedback':
            renderFeedback();
            break;
          case 'about':
            renderAbout();
            break;
          default:
            content.innerHTML = '<p>Section not found.</p>';
        }
      }

      // Initialize
      checkAuth();
    })();
  </script>
</body>
</html>
